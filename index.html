<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç™¼ç²’å­ v4.6 - é›¶å»¶é²æ ¡é©—ç‰ˆ</title>
    <style>
        :root { --bg: #050505; --text: #dcdcdc; --accent: #ff3e3e; --gold: #ffd700; --card-bg: #151515; }
        body { font-family: "Consolas", "Microsoft JhengHei", monospace; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }
        #game { width: 100%; max-width: 600px; }
        .piece { display: inline-block; width: 44px; height: 44px; line-height: 44px; border: 2px solid #333; border-radius: 50%; margin: 4px; cursor: pointer; background: #1a1a1a; font-weight: bold; font-size: 1.3rem; text-align: center; transition: all 0.2s; user-select: none; }
        .piece.red { color: #ff3333; border-color: #8b0000; text-shadow: 0 0 5px rgba(255, 51, 51, 0.3); }
        .piece.black { color: #bbbbbb; border-color: #444; }
        .piece.selected { border-color: var(--gold); transform: translateY(-8px); box-shadow: 0 5px 15px rgba(255,215,0,0.3); }
        .piece.covered { background: #222; color: #222; border-color: #333; }
        .phase-container { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #222; text-align: center; }
        .table-area { min-height: 100px; background: #000; border-radius: 15px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; border: 2px solid #1a1a1a; margin: 10px 0; }
        .card-slot { border-bottom: 1px solid #1a1a1a; padding: 5px; min-height: 80px; position: relative; }
        .score-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; width: 100%; }
        .score-box { background: #111; padding: 8px; border-radius: 8px; text-align: center; border-bottom: 2px solid var(--accent); font-size: 0.8rem; }
        button { background: #222; color: #fff; border: 1px solid #444; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 4px; }
        button.primary { background: var(--accent); border: none; }
        button.super-reset { background: #331111; color: #888; font-size: 0.6rem; border: none; margin-top: 10px; width: 100%; }
        button:disabled { background: #111; color: #444; border-color: #222; cursor: not-allowed; opacity: 0.5; }
        input#room-input { background: #000; color: var(--gold); border: 1px solid #444; padding: 12px; text-align: center; font-size: 1.5rem; width: 180px; margin-bottom: 20px; border-radius: 12px; }
        .diag-text { font-size: 0.85rem; color: var(--gold); margin: 10px 0; min-height: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="lobby">
        <h1 style="color:var(--accent); letter-spacing:8px;">ç™¼ç²’å­ <small style="font-size:0.5rem; letter-spacing:0;">v4.6</small></h1>
        <div id="room-selection-ui" class="phase-container">
            <input type="text" id="room-input" placeholder="æˆ¿è™Ÿ (å¦‚ 8888)" maxlength="4">
            <button id="btn-enter-room" class="primary" style="width:100%; height:50px; margin-top:10px;" onclick="enterRoom()">é€²å…¥å¤§å»³</button>
        </div>
        <div id="seat-selection" class="phase-container hidden">
            <p style="font-size:0.75rem; color:var(--gold); margin-bottom:15px;">æˆ¿é–“: <span id="current-room-id"></span></p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button id="btn-join-1" onclick="join(1)">P1 (ä¸»)</button>
                <button id="btn-join-2" onclick="join(2)">P2</button>
                <button id="btn-join-3" onclick="join(3)">P3</button>
                <button id="btn-join-4" onclick="join(4)">P4</button>
            </div>
        </div>
    </div>

    <div id="game" class="hidden">
        <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:#444; margin-bottom:8px;">
            <span>ROOM: <b id="room-display"></b> | ä½ æ˜¯ <b id="my-id-display" style="color:var(--gold)"></b></span>
            <span id="deck-counter">ç¬¬ 1 / 10 å‰¯ç‰Œ</span>
        </div>
        <div class="score-row" id="score-ui"></div>
        <div id="action-ui" class="phase-container">
            <div id="diag-msg" class="diag-text"></div>
            <div id="control-buttons">
                <button id="btn-head-play" class="primary hidden" onclick="headPlay()">æŠ•æ”¾ç²’å­</button>
                <button id="btn-head-reveal" class="primary hidden" onclick="headReveal()">æ€ç‰Œ</button>
                <button id="btn-follow-play" class="primary hidden" onclick="followPlay()">æŠ•æ”¾ç²’å­</button>
                <button id="btn-reveal-yes" class="primary hidden" onclick="revealDecision(true)">é–‹ç‰ŒæŒ‘æˆ°</button>
                <button id="btn-reveal-no" class="hidden" onclick="revealDecision(false)">æ‚¶ç‰Œ Pass</button>
            </div>
            <div id="pattern-hint" style="color:#666; font-size:0.8rem; margin-top:10px;"></div>
        </div>
        <div id="counting-phase" class="phase-container hidden">
            <h3 style="color:var(--gold)">ğŸ² æŒ‡é‹éšæ®µ</h3>
            <p style="font-size:0.8rem">ç•¶å‰ç•¶å®¶ï¼š<span id="current-dealer-name" style="color:white">?</span></p>
            <input type="number" id="finger-num" min="0" max="10" value="0" style="width:80px; padding:12px; background:#000; color:#fff; border:1px solid #333; font-size:1.5rem; text-align:center;">
            <button class="primary" onclick="submitFinger()" style="width:100%; margin-top:10px;">ç¢ºå®šé€å‡º</button>
            <p id="missing-players" style="font-size:0.7rem; color:#666; margin-top:5px;"></p>
        </div>
        <div class="table-area" id="table">
            <div class="card-slot" id="slot-p1"><small>P1</small><span class="pattern-label" id="label-p1"></span><div class="cards"></div></div>
            <div class="card-slot" id="slot-p2"><small>P2</small><span class="pattern-label" id="label-p2"></span><div class="cards"></div></div>
            <div class="card-slot" id="slot-p3"><small>P3</small><span class="pattern-label" id="label-p3"></span><div class="cards"></div></div>
            <div class="card-slot" id="slot-p4"><small>P4</small><span class="pattern-label" id="label-p4"></span><div class="cards"></div></div>
        </div>
        <div class="phase-container">
            <div id="my-hand" style="margin-top:10px; min-height:50px;"></div>
            <div style="margin-top:15px; display:flex; justify-content:center; gap:10px;"><button class="sort-btn" onclick="sortHand('rank')">å¤§å°</button><button class="sort-btn" onclick="sortHand('pattern')">ç‰Œå‹</button></div>
            <button id="btn-reset" class="hidden" onclick="initRound(false)" style="width:100%; margin-top:15px; border-color:var(--accent);">ä¸‹ä¸€å‰¯ç‰Œ</button>
            <button id="btn-final-reset" class="hidden" onclick="initRound(true)" style="width:100%; margin-top:15px; background:var(--gold); color:#000;">å¤§è³½çµæŸï¼šå…¨å ´é‡ç½®</button>
            <button class="super-reset" onclick="forceCleanDatabase()">ğŸ”¥ é‡ç½®æœ¬æˆ¿è³‡æ–™</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, get, remove, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyA15KzswwEHzY_jg2RvFV0T_CAD19EX7MY", authDomain: "hualiaba.firebaseapp.com", databaseURL: "https://hualiaba-default-rtdb.firebaseio.com", projectId: "hualiaba", appId: "1:1066537441904:web:1b5d1c5e4d1b987eb072b5" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let roomID, gameRef, seatsRef, myID, myHand = [], gameState = {};
    const rankMap = { "ç´…å¸¥":7, "ç´…ä»•":6, "ç´…ç›¸":5, "ç´…ä¿¥":4, "ç´…å‚Œ":3, "ç´…ç‚®":2, "ç´…å…µ":1, "é»‘å°‡":6.5, "é»‘å£«":5.5, "é»‘è±¡":4.5, "é»‘è»Š":3.5, "é»‘é¦¬":2.5, "é»‘åŒ…":1.5, "é»‘å’":0.5 };

    window.enterRoom = () => {
        const val = document.getElementById('room-input').value.trim();
        if(!val) return;
        roomID = val; gameRef = ref(db, `rooms/${roomID}/game`); seatsRef = ref(db, `rooms/${roomID}/seats`);
        document.getElementById('current-room-id').innerText = roomID;
        document.getElementById('room-display').innerText = roomID;
        document.getElementById('room-selection-ui').classList.add('hidden');
        document.getElementById('seat-selection').classList.remove('hidden');
        onValue(seatsRef, (snap) => {
            const s = snap.val() || {};
            [1,2,3,4].forEach(i => {
                const btn = document.getElementById(`btn-join-${i}`);
                btn.disabled = !!s[`p${i}`]; btn.innerText = s[`p${i}`] ? `P${i} (æ»¿)` : `P${i} ${i===1?'(ä¸»)':''}`;
            });
        });
    };

    window.join = (id) => {
        const target = `p${id}`;
        runTransaction(ref(db, `rooms/${roomID}/seats/${target}`), (c) => c === true ? undefined : true).then((res) => {
            if (!res.committed) return alert("æ¶ä½å¤±æ•—");
            myID = target;
            document.getElementById('my-id-display').innerText = target.toUpperCase();
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            onValue(gameRef, (snap) => { 
                const d = snap.val(); if(!d) { initRound(true); return; }
                gameState = d; myHand = d[`${myID}_hand`] || []; updateUI(); 
            });
            window.onbeforeunload = () => { update(seatsRef, { [myID]: null }); };
        });
    };

    window.initRound = (isFull) => {
        const dCount = isFull ? 1 : (gameState.deckCount || 1) + 1;
        const scores = isFull ? {p1:0,p2:0,p3:0,p4:0} : (gameState.scores || {p1:0,p2:0,p3:0,p4:0});
        update(gameRef, { phase: "COUNTING", table: {}, finger_picks: {}, scores: scores, deckCount: dCount, dealer: gameState.dealer || "p1", p1_hand:[], p2_hand:[], p3_hand:[], p4_hand:[] });
    };

    const getP = (c) => {
        if (!c || c.length === 0) return 0;
        const n = c.map(x => x[1]).sort().join(''), r = c.every(x => x.includes('ç´…'));
        if (n === "ä»•å¸¥ç›¸" || n === "å£«å°‡è±¡") return r ? 100 : 95; if (n === "å‚Œä¿¥ç‚®" || n === "åŒ…è»Šé¦¬") return r ? 85 : 80;
        if (c.length >= 3 && c.every(x => x[1] === "å…µ" || x[1] === "å’")) return 50 + c.length;
        return c.length === 2 && c[0][1] === c[1][1] && c[0][0] === c[1][0] ? 40 + rankMap[c[0]] : Math.max(...c.map(x => rankMap[x]));
    };

    function updateUI() {
        const ph = gameState.phase, table = gameState.table || {}, isH = (myID === gameState.head), hasP = !!table[myID];
        document.getElementById('deck-counter').innerText = `ç¬¬ ${gameState.deckCount || 1} / 10 å‰¯ç‰Œ`;
        document.getElementById('score-ui').innerHTML = [1,2,3,4].map(i => `<div class="score-box">P${i}<br><b>${(gameState.scores?.[`p${i}`]||0) + ((gameState.scores?.[`p${i}`]||0) >= 32 ? 10 : 0)}</b></div>`).join('');
        document.getElementById('counting-phase').className = ph === "COUNTING" ? "phase-container" : "hidden";
        document.getElementById('current-dealer-name').innerText = (gameState.dealer || "p1").toUpperCase();
        
        if(ph === "COUNTING") {
            const picks = gameState.finger_picks || {}; 
            const pickCount = Object.keys(picks).length;
            document.getElementById('diag-msg').innerText = `ğŸ² å·²é€å‡ºæŒ‡é‹: ${pickCount} / 4`;
            
            // é¡¯ç¤ºèª°é‚„æ²’é€æ•¸å­—
            const missing = [1,2,3,4].filter(i => !picks[`p${i}`]).map(i => "P"+i);
            document.getElementById('missing-players').innerText = missing.length ? `ç­‰å¾…ç©å®¶ï¼š${missing.join(', ')}` : "æ­£åœ¨ç™¼ç‰Œ...";

            // æ ¸å¿ƒä¿®æ­£ï¼šè‡ªå‹•ç™¼ç‰Œé–ï¼Œç¢ºä¿åªç”±ä¸€å€‹äººç™¼ç‰Œä¸” 0 è¢«æ­£ç¢ºè™•ç†
            if(pickCount === 4) {
                if (gameState.isDealing) return; // é˜²æ­¢é‡è¤‡ç™¼ç‰Œ
                const isDealer = myID === (gameState.dealer || "p1");
                if (isDealer) resolveHeadAndDeal();
            }
        }

        document.getElementById('my-hand').innerHTML = myHand.length ? myHand.map((p, i) => `<div class="piece ${p.includes('ç´…')?'red':'black'} ${selectedIdx.includes(i)?'selected':''}" onclick="togglePiece(${i})">${p[1]}</div>`).join('') : "<div style='color:#666'>æ‰‹ç‰Œç©ºç©ºå¦‚ä¹Ÿ...</div>";
        [1,2,3,4].forEach(i => {
            const pid = `p${i}`, pData = table[pid];
            document.querySelector(`#slot-p${i} .cards`).innerHTML = pData ? pData.cards.map(c => (pData.revealed || pid == myID) ? `<div class="piece ${c.includes('ç´…')?'red':'black'}">${c[1]}</div>` : `<div class="piece covered">?</div>`).join('') : "";
            document.getElementById(`label-p${i}`).innerText = pData?.declared || "";
        });

        document.getElementById('btn-head-play').className = (ph === "HEAD_PLAYING" && isH) ? "primary" : "hidden";
        document.getElementById('btn-head-reveal').className = (ph === "HEAD_REVEALING" && isH) ? "primary" : "hidden";
        document.getElementById('btn-follow-play').className = (ph === "FOLLOW_PLAYING" && !isH && !hasP) ? "primary" : "hidden";
        const rBtn = document.getElementById('btn-reveal-yes');
        if (ph === "REVEAL_DECISION" && !isH && hasP && table[myID]?.decision === "pending") {
            const canW = getP(table[myID].cards) > getP(table[gameState.head]?.cards);
            rBtn.className = "primary"; rBtn.disabled = !canW; rBtn.innerText = canW ? "é–‹ç‰ŒæŒ‘æˆ°" : "å¨åŠ›ä¸è¶³";
        } else rBtn.className = "primary hidden";
        document.getElementById('btn-reveal-no').className = (ph === "REVEAL_DECISION" && !isH && hasP && table[myID]?.decision === "pending") ? "" : "hidden";

        const diag = document.getElementById('diag-msg');
        if(ph === "HEAD_PLAYING") diag.innerText = isH ? "ğŸ‘‰ è©²ä½ å‡ºç‰Œ" : `ç­‰å¾… ${gameState.head.toUpperCase()} å‡ºç‰Œ`;
        else if(ph === "FOLLOW_PLAYING") diag.innerText = hasP ? "ç­‰å¾…å…¶ä»–äºº..." : `ğŸ‘‰ è«‹è·ŸæŠ• ${table[gameState.head]?.cards?.length || 0} é¡†`;
        else if(ph === "HEAD_REVEALING") diag.innerText = isH ? "ğŸ‘‰ å…¨å“¡å·²æŠ•ï¼Œé»æ“Šæ€ç‰Œ" : `ç­‰å¾…é ­å®¶æ€ç‰Œ`;
        else if(ph === "REVEAL_DECISION") diag.innerText = (table[myID]?.decision === "pending") ? "ğŸ‘‰ æ±ºå®šæŒ‘æˆ°æˆ–æ‚¶ç‰Œ" : "ç­‰å¾…å…¶ä»–äºº...";
        else if(ph === "RESOLVING") diag.innerText = "ğŸ”„ çµç®—è½‰å ´ä¸­...";

        const allE = !gameState.p1_hand?.length && !gameState.p2_hand?.length && !gameState.p3_hand?.length && !gameState.p4_hand?.length;
        const isF = (ph === "FINISHED" || (ph === "HEAD_PLAYING" && allE && gameState.deckCount > 0));
        document.getElementById('btn-reset').className = (isF && gameState.deckCount < 10 && myID === (gameState.dealer || "p1")) ? "primary" : "hidden";
        document.getElementById('btn-final-reset').className = (isF && gameState.deckCount >= 10 && myID === (gameState.dealer || "p1")) ? "primary" : "hidden";
    }

    window.togglePiece = (i) => {
        const idx = selectedIdx.indexOf(i); if(idx > -1) selectedIdx.splice(idx, 1); else selectedIdx.push(i);
        const sel = selectedIdx.map(x => myHand[x]); const names = sel.map(s => s[1]).sort().join('');
        let h = "éç‰Œå‹";
        if(sel.length===1) h="ä¸€é¡†"; else if(sel.length===2 && sel[0][1]===sel[1][1]) h="ä¸€å°";
        else if(sel.length===3 && (names==="ä»•å¸¥ç›¸" || names==="å£«å°‡è±¡" || names==="å‚Œä¿¥ç‚®" || names==="åŒ…è»Šé¦¬")) h="ä¸€å±€";
        else if(sel.length>=3 && sel.every(s => s[1]==="å…µ" || s[1]==="å’")) h="å…µå’çµ„";
        document.getElementById('pattern-hint').innerText = `é åˆ¤ï¼š${h}`; updateUI();
    };

    window.sortHand = (t) => {
        const o = {"å¸¥":1,"å°‡":1,"ä»•":2,"å£«":2,"ç›¸":3,"è±¡":3,"ä¿¥":4,"è»Š":4,"å‚Œ":5,"é¦¬":5,"ç‚®":6,"åŒ…":6,"å…µ":7,"å’":7};
        myHand.sort((a,b) => t==='rank' ? (rankMap[b]-rankMap[a]) : ((o[a[1]]||99)-(o[b[1]]||99) || a[0].localeCompare(b[0])));
        update(gameRef, { [`${myID}_hand`]: myHand });
    };

    window.submitFinger = () => { update(gameRef, { [`finger_picks/${myID}`]: parseInt(document.getElementById('finger-num').value) }); };

    // æ”¹é€²å¾Œçš„åŸå­åŒ–ç™¼ç‰Œï¼šè§£æ±º 0 èˆ‡é‡è¤‡ç™¼ç‰Œ Bug
    window.resolveHeadAndDeal = async () => {
        runTransaction(gameRef, (current) => {
            if (!current || !current.finger_picks || Object.keys(current.finger_picks).length < 4 || current.isDealing) return;
            current.isDealing = true; // æ¨™è¨˜æ­£åœ¨ç™¼ç‰Œï¼Œé–ä½é˜²æ­¢é‡è¤‡é€²å…¥
            return current;
        }).then(async (result) => {
            if (!result.committed) return;
            const d = result.snapshot.val();
            const sum = Object.values(d.finger_picks).reduce((a,b) => a+b, 0);
            const dealerIdx = parseInt((d.dealer||"p1").slice(1)) - 1;
            // æ­£å‘é¤˜æ•¸æ ¡æ­£ï¼šJS æ•¸å­¸å…¬å¼ä¿®æ­£
            const headIdx = (((dealerIdx + sum - 1) % 4) + 4) % 4;
            const head = `p${headIdx + 1}`;
            const p = ["ç´…å¸¥","ç´…ä»•","ç´…ä»•","ç´…ç›¸","ç´…ç›¸","ç´…ä¿¥","ç´…ä¿¥","ç´…å‚Œ","ç´…å‚Œ","ç´…ç‚®","ç´…ç‚®","ç´…å…µ","ç´…å…µ","ç´…å…µ","ç´…å…µ","ç´…å…µ","é»‘å°‡","é»‘å£«","é»‘å£«","é»‘è±¡","é»‘è±¡","é»‘è»Š","é»‘è»Š","é»‘é¦¬","é»‘é¦¬","é»‘åŒ…","é»‘åŒ…","é»‘å’","é»‘å’","é»‘å’","é»‘å’","é»‘å’"];
            const s = p.sort(() => Math.random() - 0.5);
            
            await update(gameRef, { 
                phase: "HEAD_PLAYING", head, table: {}, finger_picks: null, 
                p1_hand: s.slice(0, 8), p2_hand: s.slice(8, 16), p3_hand: s.slice(16, 24), p4_hand: s.slice(24, 32),
                isDealing: false // ç™¼ç‰Œå®Œç•¢ï¼Œè§£é–
            });
        });
    };

    window.headPlay = () => {
        const sel = selectedIdx.map(i => myHand[i]); const names = sel.map(s => s[1]).sort().join('');
        let h = "éç‰Œå‹";
        if(sel.length===1) h="ä¸€é¡†"; else if(sel.length===2 && sel[0][1]===sel[1][1]) h="ä¸€å°";
        else if(sel.length===3 && (names==="ä»•å¸¥ç›¸" || names==="å£«å°‡è±¡" || names==="å‚Œä¿¥ç‚®" || names==="åŒ…è»Šé¦¬")) h="ä¸€å±€";
        else if(sel.length>=3 && sel.every(s => s[1]==="å…µ" || s[1]==="å’")) h="å…µå’çµ„";
        update(gameRef, { phase: "FOLLOW_PLAYING", [`table/${myID}`]: { cards: sel, revealed: false, declared: h, decision: "reveal" }, [`${myID}_hand`]: myHand.filter((_, i) => !selectedIdx.includes(i)) });
        selectedIdx = [];
    };

    window.followPlay = () => {
        const need = gameState.table[gameState.head].cards.length;
        if(selectedIdx.length !== need) return alert(`éœ€æŠ• ${need} é¡†`);
        update(gameRef, { [`table/${myID}`]: { cards: selectedIdx.map(i => myHand[i]), revealed: false, decision: "pending" }, [`${myID}_hand`]: myHand.filter((_, i) => !selectedIdx.includes(i)) }).then(() => {
            get(gameRef).then(s => { if(Object.keys(s.val().table || {}).length === 4) update(gameRef, { phase: "HEAD_REVEALING" }); });
        });
        selectedIdx = [];
    };

    window.headReveal = () => { update(gameRef, { phase: "REVEAL_DECISION", [`table/${gameState.head}/revealed`]: true }); };

    window.revealDecision = (res) => {
        update(gameRef, { [`table/${myID}/decision`]: res ? "reveal" : "muffle", [`table/${myID}/revealed`]: !!res }).then(() => {
            get(gameRef).then(s => {
                const d = s.val(); let dc = 0; [1,2,3,4].forEach(i => { if(d.table[`p${i}`]?.decision !== "pending") dc++; });
                if(dc === 4) { update(gameRef, { phase: "RESOLVING" }); setTimeout(() => resolveWinner(d), 1200); }
            });
        });
    };

    function resolveWinner(d) {
        let win = d.head, max = -1;
        [1,2,3,4].forEach(i => { const p = d.table[`p${i}`]; if(p?.decision === "reveal") { const pw = getP(p.cards); if(pw > max) { max = pw; win = `p${i}`; } } });
        const ns = d.scores || {p1:0, p2:0, p3:0, p4:0}; ns[win] += (d.table[d.head]?.cards?.length || 0) * 4;
        const nextD = { "p1": "p2", "p2": "p3", "p3": "p4", "p4": "p1" };
        const isDOver = !d.p1_hand?.length && !d.p2_hand?.length && !d.p3_hand?.length && !d.p4_hand?.length;
        update(gameRef, { phase: isDOver ? "FINISHED" : "HEAD_PLAYING", head: win, table: {}, scores: ns, dealer: isDOver ? nextD[d.dealer || "p1"] : (d.dealer || "p1") });
    }

    window.forceCleanDatabase = () => { if(confirm("é‡ç½®æˆ¿é–“ï¼Ÿ")) remove(ref(db, `rooms/${roomID}`)).then(() => location.reload()); };
</script>
</body>
</html>
